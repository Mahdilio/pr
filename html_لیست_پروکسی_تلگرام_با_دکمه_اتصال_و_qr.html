<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>لیست پروکسی تلگرام | اتصال + QR + کپی</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    body{margin:0; font-family:"Vazirmatn", sans-serif; background:#0b1020; color:#e8ecf8}
    .container{max-width:1200px; margin:0 auto; padding:24px}
    header{display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; background:#121735; border-radius:14px; padding:16px}
    h1{font-size:22px; margin:0}
    .controls{display:flex; gap:10px; flex-wrap:wrap}
    .input, select{background:#171d44; color:#e8ecf8; border:none; border-radius:10px; padding:8px 12px}
    .btn{cursor:pointer; background:#7aa2ff; color:#000; border:none; padding:10px 14px; border-radius:10px; font-weight:700}
    .grid{display:grid; grid-template-columns: repeat( auto-fill, minmax(280px, 1fr) ); gap:14px; margin-top:18px}
    .card{background:#171d44; border-radius:14px; padding:14px; display:flex; flex-direction:column; gap:10px}
    .kv{display:grid; grid-template-columns: 90px 1fr; gap:6px 10px; font-size:14px}
    .value{font-family: monospace}
    .actions{display:flex; gap:8px; flex-wrap:wrap}
    .act{flex:1; min-width: 90px; padding:10px; border-radius: 10px; background:#1a2150; color:#fff; cursor:pointer; text-align:center}
    .act.primary{background:#7aa2ff; color:#000; font-weight:800}
    .modal{position:fixed; inset:0; background: rgba(0,0,0,.7); display:none; align-items:center; justify-content:center}
    .modal.open{display:flex}
    .modal-card{background:#121735; border-radius:14px; padding:18px; width:min(400px,90vw)}
    .qr{display:flex; justify-content:center; padding:10px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>لیست پروکسی‌های تلگرام</h1>
      <div class="controls">
        <input id="search" class="input" placeholder="جستجو..." />
        <select id="typeFilter">
          <option value="">همه انواع</option>
          <option value="mtproto">MTProto</option>
          <option value="socks5">SOCKS5</option>
        </select>
        <button class="btn" id="reload">بارگذاری مجدد</button>
      </div>
    </header>

    <div id="status"></div>
    <div id="grid" class="grid"></div>
  </div>

  <div class="modal" id="qrModal">
    <div class="modal-card">
      <h3>QR کد اتصال</h3>
      <div class="qr" id="qrWrap"></div>
      <button class="btn" id="closeQR">بستن</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    const API_MTPROTO = "https://mtpro.xyz/api/"; // برمی‌گرداند لیست MTProto
    const API_SOCKS = "https://mtpro.xyz/api/?type=socks"; // برمی‌گرداند لیست SOCKS5

    const state = { proxies:[], filtered:[] };
    const grid = document.getElementById('grid');
    const statusBox = document.getElementById('status');

    function mapFromAPI(item, type){
      if(type==='mtproto'){
        return {
          type:'mtproto',
          host:item.host,
          port:item.port,
          secret:item.secret,
          country:item.country,
          ping:item.ping,
          uptime:item.uptime,
          source:item.provider
        };
      } else {
        return {
          type:'socks5',
          host:item.ip,
          port:item.port,
          user:item.user,
          pass:item.pass,
          country:item.country,
          ping:item.ping,
          source:item.provider
        };
      }
    }

    function buildTelegramLink(p){
      if(p.type==='socks5'){
        const q = new URLSearchParams({ server:p.host, port:p.port });
        if(p.user) q.set('user', p.user);
        if(p.pass) q.set('pass', p.pass);
        return `tg://socks?${q.toString()}`;
      } else {
        const q = new URLSearchParams({ server:p.host, port:p.port, secret:p.secret });
        return `tg://proxy?${q.toString()}`;
      }
    }

    function render(){
      grid.innerHTML = '';
      state.filtered.forEach(p=>{
        const link = buildTelegramLink(p);
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML = `
          <div class="kv">
            <div>نوع</div><div>${p.type}</div>
            <div>کشور</div><div>${p.country}</div>
            <div>میزبان</div><div>${p.host}</div>
            <div>پورت</div><div>${p.port}</div>
            ${p.secret?`<div>Secret</div><div>${p.secret}</div>`:''}
          </div>
          <div class="actions">
            <a class="act primary" href="${link}">اتصال</a>
            <button class="act" onclick="copyLink('${link}')">کپی</button>
            <button class="act" onclick="openQR('${link}')">QR</button>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    async function copyLink(text){
      await navigator.clipboard.writeText(text);
      statusBox.innerHTML = 'کپی شد ✔️';
      setTimeout(()=>statusBox.innerHTML='',2000);
    }

    function openQR(link){
      document.getElementById('qrWrap').innerHTML='';
      new QRCode(document.getElementById('qrWrap'), {text:link,width:256,height:256});
      document.getElementById('qrModal').classList.add('open');
    }
    document.getElementById('closeQR').onclick = ()=>{
      document.getElementById('qrModal').classList.remove('open');
    }

    async function load(){
      statusBox.innerHTML = 'در حال بارگذاری...';
      try{
        const [mt, so] = await Promise.all([
          fetch(API_MTPROTO).then(r=>r.json()),
          fetch(API_SOCKS).then(r=>r.json())
        ]);
        const mapped = mt.map(i=>mapFromAPI(i,'mtproto')).concat(so.map(i=>mapFromAPI(i,'socks5')));
        state.proxies = mapped;
        state.filtered = mapped;
        render();
        statusBox.innerHTML = '';
      }catch(e){
        statusBox.innerHTML = 'خطا در دریافت اطلاعات';
      }
    }

    document.getElementById('reload').onclick = load;
    load();
  </script>
</body>
</html>
